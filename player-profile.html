<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ç©å®¶èµ„æ–™ - æ¼è›‹è®¡åˆ†å™¨</title>
<meta name="theme-color" content="#0b0b0c">
<link rel="stylesheet" href="/src/style.css">
<style>
  .profile-header {
    text-align: center;
    padding: 32px 16px;
    background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
    border-radius: 12px;
    margin-bottom: 24px;
  }
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin: 16px 0;
  }
  .stat-item {
    background: #1a1a1a;
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid #333;
  }
  .stat-value {
    font-size: 24px;
    font-weight: bold;
    color: #22c55e;
    display: block;
    margin-bottom: 4px;
  }
  .stat-label {
    font-size: 0.85em;
    color: #888;
  }
  .honor-badge {
    display: inline-block;
    background: #2a2a2a;
    border: 1px solid #444;
    padding: 8px 12px;
    border-radius: 6px;
    margin: 4px;
  }
  .game-row {
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 6px;
    padding: 12px;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s;
  }
  .game-row:hover {
    background: #252525;
    border-color: #444;
  }
</style>
</head>
<body>
<div class="wrap">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <h1>ç©å®¶èµ„æ–™</h1>
    <div>
      <a href="/players.html" style="color: #3b82f6; text-decoration: none; margin-right: 16px;">æµè§ˆæ‰€æœ‰ç©å®¶</a>
      <a href="/" style="color: #3b82f6; text-decoration: none;">è¿”å›æ¸¸æˆ</a>
    </div>
  </div>

  <div id="profileContent">
    <div style="text-align: center; padding: 40px; color: #888;">
      åŠ è½½ä¸­...
    </div>
  </div>
</div>

<script type="module">
import { getPlayer, getPlayStyleLabel } from '/src/api/playerApi.js';
import { ACHIEVEMENTS } from '/src/stats/achievements.js';

// Format duration in seconds to readable string
function formatDuration(seconds) {
  if (!seconds) return '';
  const hours = Math.floor(seconds / 3600);
  const mins = Math.floor((seconds % 3600) / 60);
  
  if (hours > 0) {
    return `${hours}å°æ—¶${mins}åˆ†`;
  }
  return `${mins}åˆ†é’Ÿ`;
}

// Render partner/rival statistics
function renderPartnerRivalStats(player) {
  const partners = player.stats.partners || {};
  const opponents = player.stats.opponents || {};

  if (Object.keys(partners).length === 0 && Object.keys(opponents).length === 0) {
    return '';  // Don't show section if no data
  }

  // Find best/worst partners
  const partnerStats = Object.entries(partners).map(([handle, stats]) => ({
    handle,
    ...stats
  })).sort((a, b) => b.winRate - a.winRate);

  const bestPartner = partnerStats.length > 0 ? partnerStats[0] : null;
  const worstPartner = partnerStats.length > 0 ? partnerStats[partnerStats.length - 1] : null;

  // Find hardest/easiest opponents
  const opponentStats = Object.entries(opponents).map(([handle, stats]) => ({
    handle,
    ...stats
  })).sort((a, b) => a.winRate - b.winRate);  // Sort ascending for hardest

  const hardestOpponent = opponentStats.length > 0 ? opponentStats[0] : null;
  const easiestOpponent = opponentStats.length > 0 ? opponentStats[opponentStats.length - 1] : null;

  return `
    <div class="card">
      <h3>ğŸ¤ é˜Ÿå‹ä¸å¯¹æ‰‹</h3>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px;">
        <!-- Best/Worst Partners -->
        <div>
          <h4 style="font-size: 16px; color: #888; margin-bottom: 12px;">é˜Ÿå‹</h4>
          ${bestPartner ? `
            <div style="background: #1a2e1a; border: 1px solid #22c55e; padding: 12px; border-radius: 8px; margin-bottom: 8px; cursor: pointer;" onclick="viewProfile('${bestPartner.handle}')">
              <div style="color: #22c55e; font-weight: bold; margin-bottom: 4px;">ğŸ† å¤§ä½¬å¸¦æˆ‘èººèµ¢</div>
              <div style="font-size: 18px;">@${bestPartner.handle}</div>
              <div style="color: #888; font-size: 0.9em; margin-top: 4px;">
                ${bestPartner.games}åœº Â· ${bestPartner.wins}èƒœ Â· ${(bestPartner.winRate * 100).toFixed(1)}%èƒœç‡
              </div>
            </div>
          ` : ''}
          ${worstPartner && worstPartner.handle !== bestPartner?.handle && partnerStats.length > 1 ? `
            <div style="background: #2a1a1a; border: 1px solid #ef4444; padding: 12px; border-radius: 8px; cursor: pointer;" onclick="viewProfile('${worstPartner.handle}')">
              <div style="color: #ef4444; font-weight: bold; margin-bottom: 4px;">ğŸ˜… ä½ å°±å·ç€ä¹å§</div>
              <div style="font-size: 18px;">@${worstPartner.handle}</div>
              <div style="color: #888; font-size: 0.9em; margin-top: 4px;">
                ${worstPartner.games}åœº Â· ${worstPartner.wins}èƒœ Â· ${(worstPartner.winRate * 100).toFixed(1)}%èƒœç‡
              </div>
            </div>
          ` : ''}
        </div>

        <!-- Hardest/Easiest Opponents -->
        <div>
          <h4 style="font-size: 16px; color: #888; margin-bottom: 12px;">å¯¹æ‰‹</h4>
          ${hardestOpponent ? `
            <div style="background: #2a1a2a; border: 1px solid #a855f7; padding: 12px; border-radius: 8px; margin-bottom: 8px; cursor: pointer;" onclick="viewProfile('${hardestOpponent.handle}')">
              <div style="color: #a855f7; font-weight: bold; margin-bottom: 4px;">âš”ï¸ æ—¢ç”Ÿç‘œä½•ç”Ÿäº®</div>
              <div style="font-size: 18px;">@${hardestOpponent.handle}</div>
              <div style="color: #888; font-size: 0.9em; margin-top: 4px;">
                ${hardestOpponent.games}åœº Â· ${hardestOpponent.wins}èƒœ Â· ${(hardestOpponent.winRate * 100).toFixed(1)}%èƒœç‡
              </div>
            </div>
          ` : ''}
          ${easiestOpponent && easiestOpponent.handle !== hardestOpponent?.handle && opponentStats.length > 1 ? `
            <div style="background: #1a2a1a; border: 1px solid #3b82f6; padding: 12px; border-radius: 8px; cursor: pointer;" onclick="viewProfile('${easiestOpponent.handle}')">
              <div style="color: #3b82f6; font-weight: bold; margin-bottom: 4px;">ğŸ è¿™æ˜¯é€åˆ†æ¥çš„</div>
              <div style="font-size: 18px;">@${easiestOpponent.handle}</div>
              <div style="color: #888; font-size: 0.9em; margin-top: 4px;">
                ${easiestOpponent.games}åœº Â· ${easiestOpponent.wins}èƒœ Â· ${(easiestOpponent.winRate * 100).toFixed(1)}%èƒœç‡
              </div>
            </div>
          ` : ''}
        </div>
      </div>

      <!-- All Partners List -->
      ${partnerStats.length > 0 ? `
        <div style="margin-top: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h4 style="font-size: 16px; color: #888; margin: 0;">æ‰€æœ‰é˜Ÿå‹ (${partnerStats.length})</h4>
            <select id="partnerSort" style="padding: 6px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; color: #fff;">
              <option value="winrate">æŒ‰èƒœç‡æ’åº</option>
              <option value="games">æŒ‰åœºæ¬¡æ’åº</option>
              <option value="wins">æŒ‰èƒœåœºæ’åº</option>
            </select>
          </div>
          <div id="partnersListContainer">
            ${renderPartnersList(partnerStats, 'winrate')}
          </div>
        </div>
      ` : ''}

      <!-- All Opponents List -->
      ${opponentStats.length > 0 ? `
        <div style="margin-top: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h4 style="font-size: 16px; color: #888; margin: 0;">æ‰€æœ‰å¯¹æ‰‹ (${opponentStats.length})</h4>
            <select id="opponentSort" style="padding: 6px 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; color: #fff;">
              <option value="winrate">æŒ‰èƒœç‡æ’åº</option>
              <option value="games">æŒ‰åœºæ¬¡æ’åº</option>
              <option value="wins">æŒ‰èƒœåœºæ’åº</option>
            </select>
          </div>
          <div id="opponentsListContainer">
            ${renderOpponentsList(opponentStats, 'winrate')}
          </div>
        </div>
      ` : ''}
    </div>
  `;
}

// Render functions defined outside to avoid template literal nesting issues
function renderPartnersList(stats, sortBy) {
  let sorted = [...stats];
  if (sortBy === 'games') {
    sorted.sort((a, b) => b.games - a.games);
  } else if (sortBy === 'wins') {
    sorted.sort((a, b) => b.wins - a.wins);
  } else {
    sorted.sort((a, b) => b.winRate - a.winRate);
  }

  return sorted.map((p, index) => `
    <div style="display: flex; align-items: center; padding: 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s;" onclick="viewProfile('${p.handle}')" onmouseover="this.style.background='#252525'" onmouseout="this.style.background='#1a1a1a'">
      <div style="flex: 1;">
        <div style="font-size: 16px; font-weight: 500;">@${p.handle}</div>
        <div style="color: #888; font-size: 0.9em; margin-top: 4px;">
          ${p.games}åœº Â· ${p.wins}èƒœ Â· ${(p.winRate * 100).toFixed(1)}%èƒœç‡
        </div>
      </div>
      <div style="width: 120px; text-align: right;">
        <div style="color: ${p.winRate >= 0.5 ? '#22c55e' : '#ef4444'}; font-size: 20px; font-weight: bold;">
          ${(p.winRate * 100).toFixed(1)}%
        </div>
      </div>
    </div>
  `).join('');
}

function renderOpponentsList(stats, sortBy) {
  let sorted = [...stats];
  if (sortBy === 'games') {
    sorted.sort((a, b) => b.games - a.games);
  } else if (sortBy === 'wins') {
    sorted.sort((a, b) => b.wins - a.wins);
  } else {
    sorted.sort((a, b) => a.winRate - b.winRate); // Ascending for hardest first
  }

  return sorted.map((p, index) => `
    <div style="display: flex; align-items: center; padding: 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s;" onclick="viewProfile('${p.handle}')" onmouseover="this.style.background='#252525'" onmouseout="this.style.background='#1a1a1a'">
      <div style="flex: 1;">
        <div style="font-size: 16px; font-weight: 500;">@${p.handle}</div>
        <div style="color: #888; font-size: 0.9em; margin-top: 4px;">
          ${p.games}åœº Â· ${p.wins}èƒœ Â· ${(p.winRate * 100).toFixed(1)}%èƒœç‡
        </div>
      </div>
      <div style="width: 120px; text-align: right;">
        <div style="color: ${p.winRate >= 0.5 ? '#22c55e' : '#ef4444'}; font-size: 20px; font-weight: bold;">
          ${(p.winRate * 100).toFixed(1)}%
        </div>
      </div>
    </div>
  `).join('');
}

function viewProfile(handle) {
  window.location.href = '/player-profile.html?handle=' + handle;
}

function setupPartnerRivalHandlers(player) {
  const partners = player.stats.partners || {};
  const opponents = player.stats.opponents || {};
  
  const partnerStats = Object.entries(partners).map(([handle, stats]) => ({
    handle,
    ...stats
  })).sort((a, b) => b.winRate - a.winRate);

  const opponentStats = Object.entries(opponents).map(([handle, stats]) => ({
    handle,
    ...stats
  })).sort((a, b) => a.winRate - b.winRate);

  // Store data for re-sorting
  window.partnerStatsData = partnerStats;
  window.opponentStatsData = opponentStats;

  // Partner sort handler
  const partnerSort = document.getElementById('partnerSort');
  if (partnerSort) {
    partnerSort.addEventListener('change', (e) => {
      const sortBy = e.target.value;
      document.getElementById('partnersListContainer').innerHTML = 
        renderPartnersList(window.partnerStatsData, sortBy);
    });
  }

  // Opponent sort handler
  const opponentSort = document.getElementById('opponentSort');
  if (opponentSort) {
    opponentSort.addEventListener('change', (e) => {
      const sortBy = e.target.value;
      document.getElementById('opponentsListContainer').innerHTML = 
        renderOpponentsList(window.opponentStatsData, sortBy);
    });
  }
}

// Get handle from URL query parameter
const urlParams = new URLSearchParams(window.location.search);
const handle = urlParams.get('handle');

if (!handle) {
  document.getElementById('profileContent').innerHTML = `
    <div class="card" style="text-align: center; padding: 40px;">
      <h2 style="color: #ef4444;">é”™è¯¯</h2>
      <p style="color: #888;">ç¼ºå°‘ç©å®¶ç”¨æˆ·åå‚æ•°</p>
      <p style="margin-top: 16px;">
        <a href="/players.html" style="color: #3b82f6;">æµè§ˆæ‰€æœ‰ç©å®¶</a>
      </p>
    </div>
  `;
} else {
  loadProfile(handle);
}

async function loadProfile(handle) {
  try {
    const result = await getPlayer(handle);
    const player = result.player;

    const topHonors = Object.entries(player.stats.honors)
      .filter(([_, count]) => count > 0)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5);

    document.getElementById('profileContent').innerHTML = `
      <!-- Profile Header -->
      <div class="profile-header">
        <div style="font-size: 72px; margin-bottom: 16px;">${player.emoji}</div>
        <h2 style="margin: 0 0 8px 0; font-size: 36px;">${player.displayName}</h2>
        <div style="color: #888; font-size: 18px; margin-bottom: 8px;">@${player.handle}</div>
        <div style="color: #888; font-size: 16px; margin-bottom: 16px;">
          ${getPlayStyleLabel(player.playStyle)}
        </div>
        <div style="font-style: italic; color: #fbbf24; font-size: 20px;">
          "${player.tagline}"
        </div>
      </div>

      <!-- Career Stats -->
      <div class="card">
        <h3>ğŸ“Š ç”Ÿæ¶¯ç»Ÿè®¡</h3>
        
        <h4 style="font-size: 16px; color: #888; margin: 16px 0 12px 0;">æ¸¸æˆåœºæ¬¡ (å®Œæ•´å¯¹å±€)</h4>
        <div class="stat-grid">
          <div class="stat-item">
            <span class="stat-value">${player.stats.sessionsPlayed || player.stats.gamesPlayed || 0}</span>
            <span class="stat-label">æ¸¸æˆåœºæ¬¡</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${player.stats.sessionsWon || player.stats.wins || 0}</span>
            <span class="stat-label">è·èƒœåœºæ¬¡</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${((player.stats.sessionWinRate || player.stats.winRate || 0) * 100).toFixed(1)}%</span>
            <span class="stat-label">èƒœç‡</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${(player.stats.avgRankingPerSession || player.stats.avgRanking || 0).toFixed(2)}</span>
            <span class="stat-label">åœºå‡æ’å</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${Math.round(player.stats.avgRoundsPerSession || 30)}</span>
            <span class="stat-label">åœºå‡å±€æ•°</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${player.stats.longestSessionRounds || 0}</span>
            <span class="stat-label">æœ€é•¿å±€æ•°</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${player.stats.currentWinStreak}</span>
            <span class="stat-label">å½“å‰è¿èƒœ</span>
          </div>
        </div>

        <h4 style="font-size: 16px; color: #888; margin: 16px 0 12px 0;">å•å±€æ•°æ® (æ‰€æœ‰è½®æ¬¡)</h4>
        <div class="stat-grid">
          <div class="stat-item">
            <span class="stat-value">${player.stats.roundsPlayed || 0}</span>
            <span class="stat-label">æ€»è½®æ¬¡</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${(player.stats.avgRankingPerRound || player.stats.avgRanking || 0).toFixed(2)}</span>
            <span class="stat-label">å±€å‡æ’å</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${player.stats.longestWinStreak}</span>
            <span class="stat-label">æœ€é•¿è¿èƒœ</span>
          </div>
        </div>

        <h4 style="font-size: 16px; color: #888; margin: 16px 0 12px 0;">æ¸¸æˆæ—¶é•¿</h4>
        <div class="stat-grid">
          <div class="stat-item">
            <span class="stat-value">${formatDuration(player.stats.totalPlayTimeSeconds || 0)}</span>
            <span class="stat-label">æ€»æ¸¸æˆæ—¶é•¿</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${formatDuration(player.stats.longestSessionSeconds || 0)}</span>
            <span class="stat-label">æœ€é•¿å¯¹å±€</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${formatDuration(player.stats.avgSessionSeconds || 0)}</span>
            <span class="stat-label">åœºå‡æ—¶é•¿</span>
          </div>
        </div>

        ${player.stats.recentRankings && player.stats.recentRankings.length > 0 ? `
          <div style="margin-top: 16px;">
            <h4 style="font-size: 14px; color: #888; margin-bottom: 8px;">æœ€è¿‘10åœºå¯¹å±€å†…æ’å</h4>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              ${player.stats.recentRankings.map(rank => `
                <span style="
                  background: ${rank === 1 ? '#22c55e' : rank <= 3 ? '#3b82f6' : '#666'};
                  color: white;
                  padding: 4px 10px;
                  border-radius: 4px;
                  font-weight: bold;
                ">
                  #${rank}
                </span>
              `).join('')}
            </div>
          </div>
        ` : ''}
      </div>

      <!-- Honor Collection -->
      <div class="card">
        <h3>ğŸ† è£èª‰æ”¶è— (${topHonors.length > 0 ? topHonors.reduce((sum, [_, count]) => sum + count, 0) : 0} ä¸ª)</h3>
        ${topHonors.length > 0 ? `
          <div style="margin-top: 12px;">
            ${topHonors.map(([honor, count]) => `
              <div class="honor-badge">
                <strong>${honor}</strong> Ã— ${count}
              </div>
            `).join('')}
          </div>
          ${Object.keys(player.stats.honors).length > topHonors.length ? `
            <div style="margin-top: 12px; color: #888; font-size: 0.9em;">
              + å…¶ä»– ${Object.keys(player.stats.honors).filter(h => player.stats.honors[h] === 0).length} ä¸ªè£èª‰å¾…è§£é”
            </div>
          ` : ''}
        ` : '<div style="color: #888; margin-top: 12px;">æš‚æ— è£èª‰ï¼Œç»§ç»­åŠ æ²¹ï¼</div>'}
      </div>

      <!-- Community Voting -->
      <div class="card">
        <h3>ğŸ—³ï¸ ç¥¨é€‰è£èª‰</h3>
        <div class="stat-grid">
          <div class="stat-item">
            <span class="stat-value" style="color: #22c55e;">${player.stats.mvpVotes || 0}</span>
            <span class="stat-label">è·é€‰ MVP (æœ€C)</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" style="color: #ef4444;">${player.stats.burdenVotes || 0}</span>
            <span class="stat-label">è·é€‰ç´¯èµ˜ (æœ€é—¹)</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">${((player.stats.mvpVotes || 0) + (player.stats.burdenVotes || 0))}</span>
            <span class="stat-label">æ€»ç¥¨é€‰æ¬¡æ•°</span>
          </div>
        </div>
        ${(player.stats.mvpVotes || 0) === 0 && (player.stats.burdenVotes || 0) === 0 ? `
          <div style="color: #888; margin-top: 12px; font-size: 0.9em;">
            æš‚æ— ç¥¨é€‰è®°å½•ã€‚åœ¨æˆ¿é—´æ¨¡å¼ä¸­ï¼Œè§‚ä¼—å¯ä»¥æŠ•ç¥¨é€‰å‡º MVP å’Œç´¯èµ˜ã€‚
          </div>
        ` : ''}
      </div>

      <!-- Partner/Rival Statistics -->
      ${renderPartnerRivalStats(player)}

      <!-- Achievements -->
      <div class="card">
        <h3>ğŸ–ï¸ æˆå°±å¾½ç«  (${player.achievements ? player.achievements.length : 0}/20)</h3>
        ${player.achievements && player.achievements.length > 0 ? `
          <div style="margin-top: 12px; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">
            ${player.achievements.map(achId => {
              const ach = ACHIEVEMENTS[achId];
              return ach ? `
                <div style="background: #2a2a2a; border: 1px solid #444; padding: 12px; border-radius: 8px;">
                  <div style="font-size: 32px; margin-bottom: 8px;">${ach.badge}</div>
                  <div style="font-weight: bold; margin-bottom: 4px;">${ach.name}</div>
                  <div style="font-size: 0.85em; color: #888;">${ach.desc}</div>
                </div>
              ` : '';
            }).join('')}
          </div>
        ` : '<div style="color: #888; margin-top: 12px;">æš‚æ— æˆå°±ï¼Œå¼€å§‹æ¸¸æˆè§£é”å¾½ç« ï¼</div>'}
      </div>

      <!-- Recent Games -->
      <div class="card">
        <h3>ğŸ“œ æœ€è¿‘æ¸¸æˆ (${player.recentGames.length})</h3>
        ${player.recentGames.length > 0 ? `
          <div style="margin-top: 12px;">
            ${player.recentGames.slice(0, 10).map(game => `
              <div class="game-row" onclick="location.href='/?room=${game.roomCode}'">
                <div style="flex: 1;">
                  <div style="margin-bottom: 4px;">
                    <strong style="color: ${game.teamWon ? '#22c55e' : '#ef4444'};">
                      ${game.teamWon ? 'âœ… èƒœ' : 'âŒ è´Ÿ'}
                    </strong>
                    Â· ${game.mode} Â· å¹³å‡${game.ranking}å Â· ${game.rounds}è½®
                    ${game.duration ? ` Â· ${formatDuration(game.duration)}` : ''}
                  </div>
                  <div style="font-size: 0.85em; color: #888;">
                    ${new Date(game.date).toLocaleString('zh-CN')}
                    ${game.roomCode !== 'LOCAL' ? ` Â· æˆ¿é—´ ${game.roomCode}` : ''}
                  </div>
                  ${game.honorsEarned && game.honorsEarned.length > 0 ? `
                    <div style="font-size: 0.85em; color: #fbbf24; margin-top: 4px;">
                      ğŸ† ${game.honorsEarned.join(', ')}
                    </div>
                  ` : ''}
                </div>
              </div>
            `).join('')}
          </div>
        ` : '<div style="color: #888; margin-top: 12px;">æš‚æ— æ¸¸æˆè®°å½•</div>'}
      </div>
    `;

    // Setup event handlers for partner/rival sorting after HTML is inserted
    setupPartnerRivalHandlers(player);

  } catch (error) {
    console.error('Failed to load profile:', error);
    document.getElementById('profileContent').innerHTML = `
      <div class="card" style="text-align: center; padding: 40px;">
        <h2 style="color: #ef4444;">åŠ è½½å¤±è´¥</h2>
        <p style="color: #888;">${error.message}</p>
        <p style="margin-top: 16px;">
          <a href="/players.html" style="color: #3b82f6;">æµè§ˆæ‰€æœ‰ç©å®¶</a>
        </p>
      </div>
    `;
  }
}

document.addEventListener('DOMContentLoaded', () => {
  // Assuming loadProfile is called elsewhere to load the player data
  // Once the player data is loaded, call setupPartnerRivalHandlers
  // For now, we'll just call it here to demonstrate
  const player = {
    stats: {
      partners: {
        'partner1': { games: 10, wins: 5, winRate: 0.5 },
        'partner2': { games: 8, wins: 3, winRate: 0.375 },
        'partner3': { games: 6, wins: 2, winRate: 0.333 }
      },
      opponents: {
        'opponent1': { games: 12, wins: 7, winRate: 0.583 },
        'opponent2': { games: 10, wins: 4, winRate: 0.4 },
        'opponent3': { games: 8, wins: 2, winRate: 0.25 }
      }
    }
  };
  setupPartnerRivalHandlers(player);
});
</script>
</body>
</html>
