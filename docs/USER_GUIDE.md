# 掼蛋计分器使用指南 (User Guide)

## 🎮 实时房间功能 (Real-Time Room Feature)

### 创建房间 (Creating a Room)

**作为游戏主持人 (As Game Host):**

1. **设置游戏**
   - 点击 **"生成玩家"** 创建玩家
   - 点击 **"快速开始"** 应用预设姓名，或手动输入：`小 超 豪 姐 哥 帆 夫 达`
   - 拖拽玩家到蓝队/红队进行分组

2. **创建房间**
   - 点击 **"📺 创建房间"** 按钮
   - 系统生成房间代码，如：`ROOM-A1B2`
   - 复制房间代码或完整链接分享给朋友

3. **开始游戏**
   - 正常进行游戏（拖拽排名、应用结果）
   - 游戏状态每 10 秒自动同步到云端
   - 重要操作（应用结果、进入下局）立即同步

### 加入房间 (Joining a Room)

**作为观看者 (As Viewer):**

1. **加入方式**
   - 点击 **"🔗 加入房间"** 输入房间代码
   - 或直接访问分享的链接（包含 `?room=ROOM-XXXX`）

2. **观看体验**
   - 进入只读模式，看到绿色 "观看模式" 横幅
   - 实时查看：队伍状态、比分、统计数据、历史记录
   - 每 5 秒自动检查更新，有新数据时显示 "🔄 数据已更新" 通知
   - 所有操作按钮被禁用（只能观看，无法修改）

3. **实时同步**
   - 主持人的每个操作都会在几秒内同步到观看者
   - 包括：玩家排名、比分变化、团队升级、历史记录更新

## 📱 快速功能指南

### 玩家设置
- **生成玩家**: 创建带表情头像的玩家（动物+食物表情）
- **批量输入姓名**: 空格分隔输入，如 `豪 姐 哥 帆 夫 塔` (6人模式)
- **快速开始**: 一键应用预设姓名
- **随机分配队伍**: 自动平均分配到两队

### 游戏操作
- **拖拽分组**: 将玩家拖到蓝队/红队区域
- **拖拽排名**: 将玩家拖到对应的排名位置 (第1名, 第2名...)
- **自动计算**: 排名完成后自动计算升级结果
- **应用结果**: 确认并保存到历史记录

### 特殊功能
- **A级规则**: 
  - 严格模式：必须在自己的A级获胜才能通关
  - 宽松模式：任何时候A级获胜都可通关
- **8人横扫**: 占据前4名位置可升4级
- **重置比赛**: 清空历史但保留玩家设置

## 🔧 技术说明

### 房间数据同步
- **房间存储**: 使用 Vercel KV (Redis) 存储房间数据
- **数据结构**: 包含队伍状态、玩家信息、历史记录、统计数据
- **过期机制**: 房间 24 小时后自动过期删除
- **全球访问**: 通过 Vercel Edge Network 提供低延迟访问

### 实时更新机制
- **主持人端**: 游戏状态变化 → 10秒定时同步 + 重要操作立即同步
- **观看者端**: 5秒定时轮询 → 检测数据变化 → 更新UI + 显示通知
- **冲突处理**: 观看者只读，避免数据冲突
- **离线处理**: 网络中断时继续本地游戏，恢复后自动同步

### 数据安全
- **房间隔离**: 每个房间独立存储，代码随机生成
- **自动过期**: 24小时TTL防止数据累积
- **只读保护**: 观看者无法修改游戏状态
- **无敏感信息**: 只存储游戏数据，无个人隐私

## 📊 使用场景

### 线下聚会
- 一人主持游戏输入结果
- 其他人手机观看实时比分
- 大屏幕显示统计数据

### 远程游戏
- 视频通话进行游戏
- 一人负责计分并分享房间
- 所有人同步查看进度

### 比赛记录
- 正式比赛实时记录
- 观众通过房间代码观看
- 自动导出完整战绩

## ❓ 常见问题

**Q: 房间代码有效期多长？**
A: 24小时后自动过期删除

**Q: 可以同时观看多少人？** 
A: 无限制，Redis支持大量并发读取

**Q: 网络中断怎么办？**
A: 本地游戏继续，网络恢复后自动同步

**Q: 房间代码会重复吗？**
A: 系统确保代码唯一性，重复时自动重新生成

**Q: 可以修改已创建的房间吗？**
A: 只有创建者可以修改，观看者只读

**Q: 支持历史记录回滚吗？**
A: 支持，主持人操作的撤销/回滚会同步到所有观看者